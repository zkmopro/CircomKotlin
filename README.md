[![](https://jitpack.io/v/zkmopro/CircomKotlin.svg)](https://jitpack.io/#zkmopro/CircomKotlin)

# Circom Kotlin Package

**CircomKotlin** is a Kotlin package for generating and verifying [Circom](https://github.com/iden3/circom) zero-knowledge proofs using the groth16 backend.

The Kotlin bindings are generated by the [**mopro CLI**](https://zkmopro.org/docs/getting-started) using the **Circom adapter**, which utilizes [`circom-prover`](https://github.com/zkmopro/mopro/tree/main/circom-prover) with [`circom-witnesscalc`](https://github.com/iden3/circom-witnesscalc) for witness generation and [`arkworks`](https://github.com/arkworks-rs) for groth16 proof construction.

To learn more about the original Rust implementation before generating bindings, please refer to [zkmopro documentation](https://zkmopro.org/docs/getting-started).

> [!NOTE]  
> To use `circom-witnesscalc`, follow the [README instructions](https://github.com/iden3/circom-witnesscalc?tab=readme-ov-file#compile-a-circuit-and-build-the-witness-graph) to generate the **graph file** from your Circom circuits.
> Or the [script](https://github.com/semaphore-protocol/semaphore-rs/blob/ccf81861d4f10f196d3c705746003c54611fe784/script/build_witness_graph.sh#L38) from [`semaphore-rs`](https://github.com/semaphore-protocol/semaphore-rs)


## Getting mopro via JitPack

To get this library from GitHub using [JitPack](https://jitpack.io/#zkmopro/CircomKotlin):

**Step 1.** Add the JitPack repository to your `settings.gradle.kts` at the end of repositories:

```kotlin
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        mavenCentral()
        maven { url = uri("https://jitpack.io") }
    }
}
```

**Step 2.** Add the dependency to your `build.gradle.kts`:

```kotlin
  dependencies {
      implementation("com.github.zkmopro:CircomKotlin:v1.0.0")
  }
```

Checkout the [JitPack page](https://jitpack.io/#zkmopro/CircomKotlin) for more available versions.

**Note:** If you're using an Android template from `mopro create`, comment out these UniFFI dependencies in your build file to prevent duplicate class errors.

```kotlin
  // // Uniffi
  // implementation("net.java.dev.jna:jna:5.13.0@aar")
  // implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.6.4")
```

## Usage Example

### Import the package

```kotlin
import uniffi.mopro.circomProve
import uniffi.mopro.verifyCircomProof
```

### Load graph and zkey

Please checkout [`circom`](https://docs.circom.io/getting-started/proving-circuits/#phase-2) and [`circom-witensscalc`](https://github.com/iden3/circom-witnesscalc?tab=readme-ov-file#compile-a-circuit-and-build-the-witness-graph) to see how to generate the zkey and the graph.

To load the circuit and graph in an Expo app, please checkout e.g. [`zkeyFilePath`](https://github.com/zkmopro/CircomReactNative/blob/5125766de72ac99774dea7f7ecdfdbc43b23736f/example/App.tsx#L43) to get the path. Then define the file path, e.g.

```kotlin
val zkeyFile = getFilePathFromAssets("multiplier2_final.zkey")
val graphFile = getFilePathFromAssets("multiplier2.bin")
```

### `circomProve`

```kotlin
val input_str: String = "{\"b\":[\"5\"],\"a\":[\"3\"]}"
val zkeyPath = zkeyFile.absolutePath
val graphPath = graphFile.absolutePath
val res = circomProve(graphPath, input_str, zkeyPath)
```

### `verifyCircomProof`

```kotlin
val valid = verifyCircomProof(zkeyPath, res, ProofLib.ARKWORKS)
```

## How to Build the Package

This package relies on bindings generated by the Mopro CLI.
To learn how to build Mopro bindings, refer to the [Getting Started](https://zkmopro.org/docs/getting-started) section.

Use `mopro-cli` and choose `circom`

```sh
mopro init
```

choose `circom`

Update the `circom-prover` resource in `Cargo.toml`

```toml
circom-prover = { git = "https://github.com/zkmopro/mopro", branch = "circom-witnesscalc-path", features = [
    "circom-witnesscalc",
] }
```

and run


```sh
mopro build
```

choose `android` and build for `aarch64-linux-android` and `x86_64-linux-android` architectures.

Then, replace the entire bindings directory with your generated files in the following location:

-   `lib/src/main/kotlin/uniffi`
-   `lib/src/main/jniLibs`

Alternatively, you can run the following commands to copy your generated bindings into the correct location:

```sh
cp -r MoproAndroidBindings/uniffi lib/src/main/kotlin
cp -r MoproAndroidBindings/jniLibs lib/src/main
```

## Community

-   X account: <a href="https://twitter.com/zkmopro"><img src="https://img.shields.io/twitter/follow/zkmopro?style=flat-square&logo=x&label=zkmopro"></a>
-   Telegram group: <a href="https://t.me/zkmopro"><img src="https://img.shields.io/badge/telegram-@zkmopro-blue.svg?style=flat-square&logo=telegram"></a>

## Acknowledgements

This work was initially sponsored by a joint grant from [PSE](https://pse.dev/) and [0xPARC](https://0xparc.org/). It is currently incubated by PSE.